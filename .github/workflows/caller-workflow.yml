# ===============================================
# ğŸ¤– AcuityBookmarks AIåŠ©æ‰‹é›†æˆå·¥ä½œæµ
# ===============================================
# 
# ğŸ¯ ç”¨é€”ï¼šé›†æˆGemini AIåŠ©æ‰‹è¿›è¡Œé¡¹ç›®ç®¡ç†è‡ªåŠ¨åŒ–
# ğŸ“‹ åŠŸèƒ½ï¼š
#   - è‡ªåŠ¨PRä»£ç å®¡æŸ¥ (AIé©±åŠ¨)
#   - Issueæ™ºèƒ½åˆ†ç±»å’Œæ ‡è®°
#   - å®šæ—¶æ‰¹é‡Issueå¤„ç†
#   - @abcå‘½ä»¤å“åº” (AIåŠ©æ‰‹äº’åŠ¨)
# 
# ğŸ”— ä¾èµ–ï¼šChenQiWen/gemini-cli-action å·¥ä½œæµ
# ğŸ¤– AIæ¨¡å‹ï¼šGoogle Gemini API
# ===============================================

name: ğŸ¤– AI Assistant Integration Pipeline

# ğŸš€ è§¦å‘æ¡ä»¶ï¼šå¤šç§GitHubäº‹ä»¶
on:
  # ğŸ“‹ æ‹‰å–è¯·æ±‚äº‹ä»¶
  pull_request:
    types: [opened, reopened]  # PRå¼€å¯æˆ–é‡æ–°å¼€å¯æ—¶è§¦å‘
    
  # ğŸ› Issueäº‹ä»¶  
  issues:
    types: [opened]  # æ–°Issueåˆ›å»ºæ—¶è§¦å‘
    
  # ğŸ’¬ è¯„è®ºäº‹ä»¶
  issue_comment:
    types: [created]  # æ–°è¯„è®ºåˆ›å»ºæ—¶è§¦å‘
    
  # â° å®šæ—¶ä»»åŠ¡
  schedule:
    - cron: '0 5 * * *'  # æ¯å¤©UTCæ—¶é—´5ç‚¹æ‰§è¡Œ (åŒ—äº¬æ—¶é—´13ç‚¹)

jobs:
  # ===============================
  # ğŸ” AIé©±åŠ¨çš„PRä»£ç å®¡æŸ¥
  # ===============================
  pr-review:
    name: ğŸ” AI-Powered PR Code Review
    # ğŸ¯ æ¡ä»¶ï¼šä»…åœ¨PRäº‹ä»¶æ—¶è¿è¡Œ
    if: github.event_name == 'pull_request'
    
    # ğŸ” æƒé™é…ç½®ï¼šAIåŠ©æ‰‹éœ€è¦çš„æœ€å°æƒé™é›†
    permissions:
      contents: 'read'        # è¯»å–ä»“åº“å†…å®¹
      id-token: 'write'       # å†™å…¥èº«ä»½ä»¤ç‰Œ
      issues: 'write'         # å†™å…¥Issueç›¸å…³å†…å®¹
      pull-requests: 'write'  # å†™å…¥PRç›¸å…³å†…å®¹
      statuses: 'write'       # å†™å…¥çŠ¶æ€æ£€æŸ¥
    
    # ğŸ”— è°ƒç”¨å¤–éƒ¨å·¥ä½œæµï¼šGemini AI PRå®¡æŸ¥
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-pr-review.yml@main
    with:
      pr_number: ${{ github.event.pull_request.number }}  # ä¼ é€’PRç¼–å·
    secrets: inherit  # ç»§æ‰¿çˆ¶ä»“åº“çš„æ‰€æœ‰secrets

  # ===============================
  # ğŸ·ï¸ Issueæ™ºèƒ½è‡ªåŠ¨åˆ†ç±»
  # ===============================
  issue-auto-triage:
    name: ğŸ·ï¸ AI Issue Auto-Triage
    # ğŸ¯ æ¡ä»¶ï¼šä»…åœ¨Issueåˆ›å»ºäº‹ä»¶æ—¶è¿è¡Œ
    if: github.event_name == 'issues'
    
    # ğŸ” æƒé™é…ç½®ï¼šIssueå¤„ç†æ‰€éœ€æƒé™
    permissions:
      contents: 'read'    # è¯»å–ä»“åº“å†…å®¹
      id-token: 'write'   # å†™å…¥èº«ä»½ä»¤ç‰Œ
      issues: 'write'     # å†™å…¥Issue (æ·»åŠ æ ‡ç­¾ã€åˆ†é…ç­‰)
      statuses: 'write'   # å†™å…¥çŠ¶æ€æ£€æŸ¥
    
    # ğŸ”— è°ƒç”¨å¤–éƒ¨å·¥ä½œæµï¼šGemini AI Issueè‡ªåŠ¨åˆ†ç±»
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-issue-automated-triage.yml@main
    with:
      issue_number: ${{ github.event.issue.number }}  # Issueç¼–å·
      issue_title: ${{ github.event.issue.title }}    # Issueæ ‡é¢˜
      issue_body: ${{ github.event.issue.body }}      # Issueå†…å®¹
    secrets: inherit

  # ===============================
  # ğŸ“… å®šæ—¶æ‰¹é‡Issueå¤„ç†
  # ===============================
  issue-scheduled-triage:
    name: ğŸ“… Scheduled Issue Batch Processing
    # ğŸ¯ æ¡ä»¶ï¼šä»…åœ¨å®šæ—¶ä»»åŠ¡è§¦å‘æ—¶è¿è¡Œ
    if: github.event_name == 'schedule'
    continue-on-error: true  # AIåŠŸèƒ½å¤±è´¥æ—¶ä¸å½±å“å…¶ä»–æ­¥éª¤
    
    # ğŸ” æƒé™é…ç½®ï¼šæ‰¹é‡å¤„ç†æ‰€éœ€æƒé™
    permissions:
      contents: 'read'    # è¯»å–ä»“åº“å†…å®¹
      id-token: 'write'   # å†™å…¥èº«ä»½ä»¤ç‰Œ
      issues: 'write'     # å†™å…¥Issueç›¸å…³å†…å®¹
      statuses: 'write'   # å†™å…¥çŠ¶æ€æ£€æŸ¥
    
    # ğŸ”— è°ƒç”¨å¤–éƒ¨å·¥ä½œæµï¼šGemini AIå®šæ—¶Issueå¤„ç†
    # ğŸ“‹ åŠŸèƒ½ï¼š
    #   - æ£€æŸ¥è¿‡æœŸæœªå›å¤çš„Issue
    #   - è‡ªåŠ¨å…³é—­å·²è§£å†³çš„Issue
    #   - æ›´æ–°Issueæ ‡ç­¾å’ŒçŠ¶æ€
    #   - å‘é€æé†’é€šçŸ¥
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-issue-scheduled-triage.yml@main
    secrets: inherit

  # ===============================
  # ğŸ—£ï¸ @abc AIåŠ©æ‰‹å‘½ä»¤å¤„ç†å™¨
  # ===============================
  abc-handler:
    name: ğŸ—£ï¸ AI Assistant Command Handler (@abc)
    # ğŸ¯ æ¡ä»¶ï¼šè¯„è®ºåŒ…å«@abcæ—¶è§¦å‘
    if: >-
      github.event_name == 'issue_comment' &&
      contains(github.event.comment.body, '@abc')
    
    # ğŸ” æƒé™é…ç½®ï¼šAIåŠ©æ‰‹äº¤äº’æ‰€éœ€çš„å®Œæ•´æƒé™
    permissions:
      contents: 'write'       # å†™å…¥ä»“åº“å†…å®¹ (å¯èƒ½éœ€è¦ä¿®æ”¹ä»£ç )
      id-token: 'write'       # å†™å…¥èº«ä»½ä»¤ç‰Œ
      pull-requests: 'write'  # å†™å…¥PRç›¸å…³å†…å®¹
      issues: 'write'         # å†™å…¥Issueç›¸å…³å†…å®¹
    
    # ğŸ”— è°ƒç”¨å¤–éƒ¨å·¥ä½œæµï¼šGemini AIå‘½ä»¤è¡Œç•Œé¢
    # ğŸ’¡ ä½¿ç”¨æ–¹æ³•ï¼š
    #   - åœ¨Issueæˆ–PRä¸­è¯„è®º "@abc è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªbug"
    #   - åœ¨Issueæˆ–PRä¸­è¯„è®º "@abc è¯·ä¼˜åŒ–è¿™æ®µä»£ç "
    #   - åœ¨Issueæˆ–PRä¸­è¯„è®º "@abc è¯·ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹"
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-cli.yml@main
    with:
      user_request: ${{ github.event.comment.body }}  # ç”¨æˆ·è¯·æ±‚å†…å®¹
      issue_number: ${{ github.event.issue.number }}  # Issueç¼–å·
      is_pr: ${{ github.event.issue.pull_request != null }}  # æ˜¯å¦ä¸ºPR
    secrets: inherit

# ===============================================
# ğŸ“‹ ä½¿ç”¨è¯´æ˜
# ===============================================
#
# ğŸ¤– AIåŠ©æ‰‹åŠŸèƒ½ï¼š
#   1. è‡ªåŠ¨PRå®¡æŸ¥ - æ£€æŸ¥ä»£ç è´¨é‡ã€å®‰å…¨æ€§ã€æœ€ä½³å®è·µ
#   2. Issueæ™ºèƒ½åˆ†ç±» - è‡ªåŠ¨æ·»åŠ æ ‡ç­¾ã€è®¾ç½®ä¼˜å…ˆçº§
#   3. å®šæ—¶ç»´æŠ¤ - æ¯æ—¥æ£€æŸ¥å’Œæ¸…ç†IssueçŠ¶æ€
#   4. å‘½ä»¤å“åº” - ä½¿ç”¨@abcä¸AIåŠ©æ‰‹äº’åŠ¨
#
# ğŸ”§ é…ç½®è¦æ±‚ï¼š
#   - GEMINI_API_KEY: Google Gemini APIå¯†é’¥
#   - GITHUB_TOKEN: GitHubè®¿é—®ä»¤ç‰Œ (è‡ªåŠ¨æä¾›)
#
# ğŸ’¡ æœ€ä½³å®è·µï¼š
#   - ä½¿ç”¨@abcå‘½ä»¤è¿›è¡Œä»£ç å®¡æŸ¥è¯·æ±‚
#   - è®©AIåŠ©æ‰‹å¸®åŠ©Issueåˆ†ç±»å’Œä¼˜å…ˆçº§è®¾ç½®
#   - å®šæœŸæ£€æŸ¥AIç”Ÿæˆçš„å»ºè®®å’Œæ ‡ç­¾
#
# ===============================================
